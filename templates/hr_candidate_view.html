<!DOCTYPE html>
<html>
<head>
  <title>HR - Candidate Report</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
{% import 'tables.html' as tables %}
<div class="container py-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Candidate Report</h3>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-secondary" href="/hr/candidates">Back</a>
      <a class="btn btn-outline-danger" href="/hr/logout">Logout</a>
    </div>
  </div>

  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <h5 class="card-title">Candidate Info</h5>
      <p class="mb-1"><b>ID:</b> {{ candidate.id }}</p>
      <p class="mb-1"><b>Name:</b> {{ candidate.name }}</p>
      <p class="mb-1"><b>Email:</b> {{ candidate.email }}</p>
      <p class="mb-1"><b>Status:</b> {{ candidate.status }}</p>
      <p class="mb-1"><b>JD Config ID:</b> {{ candidate.jd_config_id or "-" }}</p>
      {% if selected_jd %}
      <p class="mb-1"><b>JD Title:</b> {{ selected_jd.get("title", "-") }}</p>
      {% endif %}
      <p class="mb-0"><b>Created:</b> {{ candidate.created_at }}</p>
    </div>
  </div>

  <div class="d-flex gap-2 mb-3">
    <a class="btn btn-primary" target="_blank" href="/hr/candidate/{{ candidate.id }}/resume">View Resume</a>
    <a class="btn btn-outline-secondary" href="/hr/candidate/{{ candidate.id }}/resume?download=1">Download Resume</a>
  </div>

  <div class="card shadow-sm mb-3">
    <div class="card-header"><h5 class="mb-0">Domain Scores</h5></div>
    <div class="card-body">
      {{ tables.render_scores_table(phase1.get('domain_scores')) }}
    </div>
  </div>

  <div class="card shadow-sm mb-3">
    <div class="card-header"><h5 class="mb-0">Matched Keywords</h5></div>
    <div class="card-body">
      {{ tables.render_keywords_table(phase1.get('matched_details')) }}
    </div>
  </div>

  <div class="card shadow-sm mb-3">
    <div class="card-header"><h5 class="mb-0">Generated Questions</h5></div>
    <div class="card-body">
      {% if generated_questions %}
        <ol class="mb-0">
          {% for q in generated_questions %}
            <li>{{ q }}</li>
          {% endfor %}
        </ol>
      {% else %}
        <p class="text-muted mb-0">Questions could not be generated.</p>
      {% endif %}
    </div>
  </div>

  <div class="card shadow-sm mb-3">
    <div class="card-header"><h5 class="mb-0">Interview Answers</h5></div>
    <div class="card-body">
      {% if answers %}
        <div class="table-responsive">
          <table class="table table-striped mb-0">
            <thead>
              <tr>
                <th>Question</th>
                <th>Answer</th>
                <th>Time Taken (s)</th>
              </tr>
            </thead>
            <tbody>
              {% for a in answers %}
              <tr>
                <td>{{ a.get("question_text", "") }}</td>
                <td>{{ a.get("answer", "") }}</td>
                <td>{{ a.get("time_taken_seconds", 0) }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-muted mb-0">No interview answers submitted yet.</p>
      {% endif %}
    </div>
  </div>

  <div class="card shadow-sm mb-3">
    <div class="card-header"><h5 class="mb-0">Monitoring Flags</h5></div>
    <div class="card-body">
      <p class="mb-1"><b>Camera Granted:</b> {{ monitoring.get("camera_granted", false) }}</p>
      <p class="mb-1"><b>Mic Granted:</b> {{ monitoring.get("mic_granted", false) }}</p>
      <p class="mb-1"><b>Tab Switch Count:</b> {{ monitoring.get("tab_switch_count", 0) }}</p>
      <p class="mb-0"><b>Last Updated:</b> {{ monitoring.get("last_updated_at", "-") }}</p>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-header"><h5 class="mb-0">Interview Summary</h5></div>
    <div class="card-body">
      {% if summary %}
        <ul class="mb-0">
          <li>Total Questions: {{ summary.get("total_questions", 0) }}</li>
          <li>Answered Count: {{ summary.get("answered_count", 0) }}</li>
          <li>Average Answer Length: {{ summary.get("avg_answer_length", 0) }}</li>
          <li>Total Time (seconds): {{ summary.get("total_time_seconds", 0) }}</li>
          <li>Tab Switch Count: {{ summary.get("tab_switch_count", 0) }}</li>
          <li>Camera Granted: {{ summary.get("camera_granted", false) }}</li>
          <li>Mic Granted: {{ summary.get("mic_granted", false) }}</li>
          <li>Communication Score (0-10): {{ summary.get("communication_score", 0) }}</li>
        </ul>
      {% else %}
        <p class="text-muted mb-0">Interview summary not available yet.</p>
      {% endif %}
    </div>
  </div>

</div>
</body>
</html>
