<!DOCTYPE html>
<html>
<head>
  <title>HR Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h3 class="mb-0">Phase 1 - JD + Skill Weights</h3>
      {% if config and config.created_at %}
        <small class="text-muted">Last saved: {{ config.created_at }}</small>
      {% endif %}
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-secondary" href="/hr/jds">All JDs</a>
      <a class="btn btn-outline-danger" href="/hr/logout">Logout</a>
    </div>
  </div>

  {% if msg %}
    <div class="alert alert-info">{{ msg }}</div>
  {% endif %}

  <form method="POST">
    <div class="card p-3 mb-3 shadow-sm">
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label"><b>JD Title</b></label>
          <input name="title" class="form-control" required value="{{ config.title if config else '' }}">
        </div>
      </div>

      <label class="form-label"><b>Job Description (JD)</b></label>
      <textarea name="jd_text" class="form-control" rows="6" required>{{ config.jd_text if config else "" }}</textarea>

      <div class="row mt-3">
        <div class="col-md-4">
          <label class="form-label">Min Academic %</label>
          <input class="form-control" type="number" name="min_academic_percent" value="{{ config.min_academic_percent if config else 60 }}">
        </div>
        <div class="col-md-4">
          <label class="form-label">Qualify Score (0-100)</label>
          <input class="form-control" type="number" name="qualify_score" value="{{ config.qualify_score if config else 60 }}">
        </div>
        <div class="col-md-2">
          <label class="form-label">Question Count</label>
          <input class="form-control" type="number" min="1" name="question_count" value="{{ config.question_count if config else 10 }}">
        </div>
        <div class="col-md-2">
          <label class="form-label">Project Ratio %</label>
          <input class="form-control" type="number" min="0" max="100" name="project_ratio" value="{{ config.project_ratio if config else 80 }}">
        </div>
      </div>

      {% if config and config.jd_dict %}
        <input type="hidden" name="jd_dict_json" value='{{ config.jd_dict | tojson }}'>
      {% endif %}

      <div class="mt-3 d-flex gap-2">
        <button class="btn btn-secondary" name="action" value="extract">Extract Skills (LLM)</button>
        <button class="btn btn-outline-primary" name="action" value="reset">Reset Weights</button>
        <button class="btn btn-success" name="action" value="save">Save Config</button>
      </div>
    </div>

    {% set weights = config.weights if config and config.weights else {} %}
    {% set total = weights.values()|sum if weights else 0 %}

    {% if weights %}
    <div class="alert alert-warning">
      Total Weight: <b>{{ total }}</b> |
      Skills: <b>{{ weights|length }}</b>
      {% if total == 0 %}
        - Please set weights > 0
      {% endif %}
    </div>

    <div class="card p-3 shadow-sm">
      <h5 class="mb-2">Skill Weights</h5>
      <p class="text-muted mb-3">Edit % for each skill. (Total can be anything; scoring normalizes to 0-100)</p>

      <div class="row">
        {% for s,w in weights.items() %}
          <div class="col-md-4 mb-2">
            <label class="form-label">{{ s }}</label>
            <input class="form-control" type="number" name="weight_{{ s.replace(' ', '__') }}" value="{{ w }}">
          </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </form>
  <div class="d-flex gap-2">
    <a class="btn btn-primary" href="/hr/candidates">View Candidates</a>
    <a class="btn btn-outline-secondary" href="/hr/jds">Manage JDs</a>
  </div>


</div>
</body>
</html>
